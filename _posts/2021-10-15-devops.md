---
title: "AWS - CodeDeploy Error"
date: 2021-10-15
comments: true
read_time: false
toc: true
categories:
  - AWS
tags:
  - codedeploy
  - troubleshooting
---

ë³¸ë˜ ê°œì¸ì ìœ¼ë¡œ GCPë¥¼ ì‚¬ìš©í•˜ê³  ìˆì—ˆì§€ë§Œ(~~ë”±íˆ ë­˜ í•œê±° ì•„ë‹ˆì§€ë§Œ ì¸ìŠ¤í„´ìŠ¤ í•˜ë‚˜ì— ë§Œë“¤ê³  DNS ì¢€ ì“°ë‹¤ê°€ ì‹œê°„ì´ ë‹¤ ê°€ë²„ë ¸ë‹¤...~~) ë¬´ë£Œ í¬ë ˆë”§ë„ ë‹¤ ë–¨ì–´ì§„ ì°¸ì— íšŒì‚¬ì—ì„œë„ AWSë¥¼ ì´ìš©ì¤‘ì´ê¸°ì— AWSë¥¼ ì‚¬ìš©í•´ë³´ê³ ì í•˜ì˜€ë‹¤.  
Lightsailë¡œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ ìƒì„±í•˜ê³  CodeDeployë¥¼ ì—°ê²°í•´ë³´ê³ ì í•˜ì˜€ë‹¤. ê³¼ì •ì´ ì–´ë µì§€ëŠ” ì•Šì•˜ëŠ”ë° ìƒê°ë³´ë‹¤ ì‚½ì§ˆì„ í•˜ì—¬ ì‚½ì§ˆí•˜ì˜€ë˜ ë¶€ë¶„ì— ëŒ€í•´ ë©”ëª¨

## ê°€ì´ë“œ

Lightsailì— CodeDeployë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ìœ¼ì‹  ë¶„ë“¤ì´ë¼ë©´ ì•„ë˜ì˜ ê¸€ì„ ì°¸ê³ í•˜ì‹œë©´ ìˆ˜ì›”í•˜ê²Œ ì§„í–‰í•˜ì‹¤ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

[AWS CodeDeploy ê°€ì´ë“œ](https://docs.aws.amazon.com/codedeploy/latest/userguide/welcome.html)  
[ë¯¸ë””ì—„ hemant bhosaleì˜ í¬ìŠ¤íŒ…](https://medium.com/@hemantbhosale916/deploy-applications-on-aws-lightsail-using-aws-code-pipeline-aws-code-deploy-1ed2611333e6)

## ì‚½ì§ˆ1

ì²˜ìŒì— ê²€ìƒ‰í–ˆì„ ë•Œ AWS ê°€ì´ë“œê°€ í•œêµ­ì–´ë¡œ í‘œê¸°ëœ ê²ƒì´ ë‚˜ì™€ì„œ í•œêµ­ë¬¸ì„œë¡œ ë³´ê¸° ì‹œì‘í–ˆëŠ”ë° ì´ê²Œ ë¬¸ì œì˜€ë‹¤....â›ˆ  
**í•´ì™¸ ì„œë¹„ìŠ¤ì˜ ê²½ìš° ê°€ì´ë“œëŠ” ì›ì–´ë‚˜ ì˜ì–´ë¡œ ë³´ì**

`CodeDeploy`ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ëª©ì ì§€ ì„œë²„ì— `CodeDeploy Agent` í•´ì•¼ í•˜ëŠ”ë° ì„¤ì¹˜í•´ì•¼ í•˜ê³  ì„¤ì¹˜íŒŒì¼ì€ ì•„ë˜ì™€ ê°™ì´ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

```sh
wget https://<bucket-name>.s3.<region-identifier>.amazonaws.com/latest/install
```

ì—¬ê¸°ì„œ `bucket-name` ê³¼ `region-identifier` ë¥¼ ì§€ì •í•  ìˆ˜ ìˆëŠ”ë° ì–´ëŠ ë¦¬ì „ì—ì˜ ë²„í‚·ì—ì„œ ì„¤ì¹˜íŒŒì¼ì„ ê°€ì ¸ì˜¬ ê²ƒì¸ì§€ ì •í•˜ëŠ” ê²ƒì´ë‹¤.  
ì„œìš¸ ë¦¬ì „ì˜ ê²½ìš°ëŠ” ì•„ë˜ì™€ ê°™ê³ 

- `bucket-name`: aws-codedeploy-ap-northeast-2, `region-identifier`: ap-northeast-2

í˜„ì¬ í•œê¸€ ë²ˆì—­ëœ ë¬¸ì„œì—ëŠ” ì•„ë˜ì™€ ê°™ì´ ë˜ì–´ ìˆë‹¤.

- `bucket-name`: ap-codeDepy-ap-northeast-2, `region-identifier`: ap-northeast-2

`bucket-name`ì´ ì˜ëª» ë˜ì–´ ìˆë‹¤. ğŸ„

## ì‚½ì§ˆ2

ì¸ìŠ¤í„´ìŠ¤(LightSail) í˜„ì¬ CodeDeployë¥¼ ì‚¬ìš©í•  ë•Œ LightSailì€ ì˜¨í”„ë ˆë¯¸ìŠ¤ë¡œ ë³´ê¸°ë•Œë¬¸ì— ë”°ë¡œ ë“±ë¡ì„ í•´ì¤˜ì•¼ í•œë‹¤.  
ì´ ì ˆì°¨ë¥¼ LightSail ì¸ìŠ¤í„´ìŠ¤ì—ì„œ í•˜ëŠ” ê²ƒì´ ë§ë‹¤ê³  ìƒê°í–ˆìœ¼ë‚˜ AccessDenied ì™€ ë¹„ìŠ·í•œ ì¢…ë¥˜ì˜ ì˜¤ë¥˜ê°€ ë‚¬ë‹¤.
ì•„ë˜ì™€ ê°™ì€ ë“±ë¡ ì ˆì°¨ëŠ” **ë³¸ì¸ì˜ ë¡œì»¬ì´ë‚˜ aws ì„¤ì •ì´ ë˜ì–´ ìˆëŠ” ê³³**ì—ì„œ ì‘ì—…í•˜ì.
~~ë‹¹ì—°í•œ ì´ì•¼ê¸°ì§€ë§Œ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” aws-clië¥¼ ì„¤ì¹˜í•´ì•¼í•œë‹¤.~~

```sh
aws deploy register-on-premises-instance â€” instance-name <InstanceName> â€” iam-user-arn <IAM User ARN> â€” region <Region>

aws deploy add-tags-to-on-premises-instances â€” instance-names <InstanceName> â€” tags Key=Name,Value=<InstanceName> â€” region <Region>
```

- `InstanceName`: LightSail ì¸ìŠ¤í„´ìŠ¤ ì´ë¦„
- `IAM User ARN`: í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ëŒ€í‘œ? ê´€ë¦¬? í•˜ëŠ” ìœ ì €ì˜ ê°’
- `Region`: ì„¤ì¹˜í•˜ë©´ì„œ ë“±ë¡í•œ ë¦¬ì „

## ì‚½ì§ˆ3

ìœ„ ê³¼ì •ì—ì„œ ë³´ë©´ ë“±ë¡ì— ì‚¬ìš©ìê°€ í•„ìš”í•œê²ƒì„ ë³¼ ìˆ˜ ìˆëŠ”ë°(ì—¬ê¸° ì™¸ì—ë„ í•„ìš”í•˜ë‹¤.) ì˜¨í”„ë ˆë¯¸ìŠ¤ ë°©ì‹ìœ¼ë¡œ `CodeDeploy`ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” **ì¸ìŠ¤í„´ìŠ¤ í•˜ë‚˜ë‹¹ í•˜ë‚˜ì˜ ì‚¬ìš©ì**ê°€ í•„ìš”í•˜ë‹¤.

[AWS ì•ˆë‚´](https://docs.aws.amazon.com/codedeploy/latest/userguide/instances-on-premises-register-instance.html#instances-on-premises-register-instance-1-install-cli)

> You can associate only one IAM user with only one on-premises instance. Trying to associate a single IAM user with multiple on-premises instances can result in errors, failed deployments to those on-premises instances, or deployments to those on-premises instances that are stuck in a perpetual pending state.

í•œ ì‚¬ìš©ìë¡œ 2ê°œì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë“±ë¡í•˜ë ¤ë‹¤ë³´ë‹ˆ ì‚½ì§ˆì„ ì¢€ í•˜ê²Œ ë˜ì—ˆë‹¤.. ë¬¸ì„œ ì œëŒ€ë¡œ ì½ì–´ë³¼ê»„.... ğŸ˜¿

## ë²ˆì™¸ - Nuxt & Heroku

ë¬´ê´€í•œ ì´ì•¼ê¸°ì§€ë§Œ ì–´ë”˜ê°€ì— ë©”ëª¨í•´ë‘ëŠ” ê²ƒì´ ì¢‹ì„ ê°™ì•„ì„œ ê°™ì´ ë©”ëª¨

`Nuxt`ë¥¼ `Heroku`ë¥¼ í†µí•´ ë°°í¬í•  ê²½ìš° `Config Vars` ì—ì„œ `Key`ë¥¼ `HOST`, `Value`ë¥¼ `0.0.0.0` ìœ¼ë¡œ ì„¤ì •í•˜ëŠ”ë° Keyë¥¼ ëŒ€ë¬¸ìë¡œ ì‘ì„±í•˜ì..  
ì•ˆ ê·¸ëŸ´ ê²½ìš° í¬íŠ¸ ë°”ì¸ë”©ì´ ì‹¤íŒ¨í•œë‹¤.

- [Nuxt-Heroku](https://nuxtjs.org/deployments/heroku)

<hr/>

_ê°œì¸ì´ ì°¸ê³ í•˜ê³ ì ì‘ì„±í•œ ê¸€ì´ë©°, ì˜ëª»ëœ ì •ë³´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ëª»ëœ ì •ë³´ëŠ” ë©”ì¼ë¡œ ë³´ë‚´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤._ ğŸ™
